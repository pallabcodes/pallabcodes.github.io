<!DOCTYPE html>
<html lang="en">

<head>
    <title>Go Worker Pools: Channels as Synchronization | Pallab Codes</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://pallabcodes.github.io/style.css">
    <link rel="stylesheet" href="https://pallabcodes.github.io/color/green.css">

        <link rel="stylesheet" href="https://pallabcodes.github.io/color/background_dark.css">
    
    <link rel="stylesheet" href="https://pallabcodes.github.io/font-hack-subset.css">

    <meta name="description" content="How channels replace WaitGroups in worker pools, and why buffered channels outperform unbuffered ones.">

    <meta property="og:description" content="How channels replace WaitGroups in worker pools, and why buffered channels outperform unbuffered ones.">
    <meta property="og:title" content="Go Worker Pools: Channels as Synchronization | Pallab Codes">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://pallabcodes.github.io/worker-pool/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="How channels replace WaitGroups in worker pools, and why buffered channels outperform unbuffered ones.">
    <meta name="twitter:title" content="Go Worker Pools: Channels as Synchronization | Pallab Codes">
    <meta property="twitter:domain" content="pallabcodes.github.io">
    <meta property="twitter:url" content="https://pallabcodes.github.io/worker-pool/">

                <link rel="alternate" type="application/rss+xml" title="Pallab Codes RSS Feed" href="https://pallabcodes.github.io/rss.xml" />
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://pallabcodes.github.io" style="text-decoration: none;">
                    <div class="logo">
                      
                            pallab.codes
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://pallabcodes.github.io">blog</a></li>
            
                <li><a href="https://pallabcodes.github.io/tags">tags</a></li>
            
                <li><a href="https://pallabcodes.github.io/resume">resume</a></li>
            
                <li><a href="https://pallabcodes.github.io/about">about</a></li>
            
                <li><a href="https://github.com/pallabcodes" target="_blank" rel="noopener noreferrer">github</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://pallabcodes.github.io/worker-pool/">Go Worker Pools: Channels as Synchronization</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2025-12-19
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://pallabcodes.github.io/tags/channels/">#channels</a>&nbsp;
                <a class="post-tag" href="https://pallabcodes.github.io/tags/concurrency/">#concurrency</a>&nbsp;
                <a class="post-tag" href="https://pallabcodes.github.io/tags/go/">#go</a>&nbsp;
                <a class="post-tag" href="https://pallabcodes.github.io/tags/worker-pool/">#worker-pool</a></span>
    

        <div class="post-content">
            <p>A common confusion when learning Go: "If there's no <code>WaitGroup</code>, how does this program not exit early?" The answer reveals one of Go's most elegant design choices: <strong>channels can synchronize <em>and</em> transport data simultaneously</strong>.</p>
<span id="continue-reading"></span><h2 id="the-worker-pool-pattern">The Worker Pool Pattern</h2>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">worker</span><span>(</span><span style="color:#bf616a;">id </span><span style="color:#b48ead;">int</span><span>, </span><span style="color:#bf616a;">jobs </span><span>&lt;-</span><span style="color:#b48ead;">chan int</span><span>, </span><span style="color:#bf616a;">results </span><span style="color:#b48ead;">chan</span><span>&lt;- </span><span style="color:#b48ead;">int</span><span>) {
</span><span>	</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">j </span><span>:= </span><span style="color:#b48ead;">range </span><span style="color:#bf616a;">jobs </span><span>{
</span><span>		</span><span style="color:#bf616a;">fmt</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">worker</span><span>&quot;, </span><span style="color:#bf616a;">id</span><span>, &quot;</span><span style="color:#a3be8c;">started  job</span><span>&quot;, </span><span style="color:#bf616a;">j</span><span>)
</span><span>		</span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Sleep</span><span>(</span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Second</span><span>)
</span><span>		</span><span style="color:#bf616a;">fmt</span><span>.</span><span style="color:#bf616a;">Println</span><span>(&quot;</span><span style="color:#a3be8c;">worker</span><span>&quot;, </span><span style="color:#bf616a;">id</span><span>, &quot;</span><span style="color:#a3be8c;">finished job</span><span>&quot;, </span><span style="color:#bf616a;">j</span><span>)
</span><span>		</span><span style="color:#bf616a;">results </span><span>&lt;- </span><span style="color:#bf616a;">j </span><span>* </span><span style="color:#d08770;">2
</span><span>	}
</span><span>}
</span><span>
</span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>	</span><span style="color:#b48ead;">const </span><span style="color:#bf616a;">numJobs </span><span>= </span><span style="color:#d08770;">5
</span><span>	</span><span style="color:#bf616a;">jobs </span><span>:= </span><span style="color:#96b5b4;">make</span><span>(</span><span style="color:#b48ead;">chan int</span><span>, </span><span style="color:#bf616a;">numJobs</span><span>)
</span><span>	</span><span style="color:#bf616a;">results </span><span>:= </span><span style="color:#96b5b4;">make</span><span>(</span><span style="color:#b48ead;">chan int</span><span>, </span><span style="color:#bf616a;">numJobs</span><span>)
</span><span>
</span><span>	</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">w </span><span>:= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#bf616a;">w </span><span>&lt;= </span><span style="color:#d08770;">3</span><span>; </span><span style="color:#bf616a;">w</span><span>++ {
</span><span>		</span><span style="color:#b48ead;">go </span><span style="color:#bf616a;">worker</span><span>(</span><span style="color:#bf616a;">w</span><span>, </span><span style="color:#bf616a;">jobs</span><span>, </span><span style="color:#bf616a;">results</span><span>)
</span><span>	}
</span><span>
</span><span>	</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">j </span><span>:= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#bf616a;">j </span><span>&lt;= </span><span style="color:#bf616a;">numJobs</span><span>; </span><span style="color:#bf616a;">j</span><span>++ {
</span><span>		</span><span style="color:#bf616a;">jobs </span><span>&lt;- </span><span style="color:#bf616a;">j
</span><span>	}
</span><span>	</span><span style="color:#96b5b4;">close</span><span>(</span><span style="color:#bf616a;">jobs</span><span>)
</span><span>
</span><span>	</span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">a </span><span>:= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#bf616a;">a </span><span>&lt;= </span><span style="color:#bf616a;">numJobs</span><span>; </span><span style="color:#bf616a;">a</span><span>++ {
</span><span>		&lt;-</span><span style="color:#bf616a;">results
</span><span>	}
</span><span>}
</span></code></pre>
<h2 id="the-key-insight">The Key Insight</h2>
<p><strong>Receiving from a channel blocks the goroutine until a value is available.</strong></p>
<p>This single line is the entire synchronization mechanism:</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">for </span><span style="color:#bf616a;">a </span><span>:= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#bf616a;">a </span><span>&lt;= </span><span style="color:#bf616a;">numJobs</span><span>; </span><span style="color:#bf616a;">a</span><span>++ {
</span><span>	&lt;-</span><span style="color:#bf616a;">results
</span><span>}
</span></code></pre>
<p>Main will block here until all 5 results have been received. No <code>WaitGroup</code> needed.</p>
<h2 id="timeline-visualization">Timeline Visualization</h2>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Time →
</span><span>
</span><span>Main:
</span><span>  [Create channels]
</span><span>  [Spawn 3 workers] (all block waiting for jobs)
</span><span>  [Send 5 jobs]
</span><span>  [Close jobs channel]
</span><span>  [Wait for 5 results] ← BLOCKS until all done
</span><span>  [Exit]
</span><span>
</span><span>Worker 1:  [Wait] [Process job 1] [Send result] [Process job 4] [Send result] [Exit]
</span><span>Worker 2:  [Wait] [Process job 2] [Send result] [Exit]
</span><span>Worker 3:  [Wait] [Process job 3] [Send result] [Process job 5] [Send result] [Exit]
</span></code></pre>
<h2 id="why-no-waitgroup">Why No WaitGroup?</h2>
<table><thead><tr><th>Coordination Need</th><th>How It's Handled</th></tr></thead><tbody>
<tr><td>Workers finish work</td><td><code>range jobs</code> exits on close</td></tr>
<tr><td>Main waits</td><td><code>&lt;-results</code> blocks</td></tr>
<tr><td>Completion count</td><td>Number of results expected</td></tr>
</tbody></table>
<p>The <strong>data flow encodes the lifecycle</strong>. Each result received is proof of one job completed.</p>
<h2 id="buffered-vs-unbuffered-the-mailbox-analogy">Buffered vs. Unbuffered: The Mailbox Analogy</h2>
<h3 id="unbuffered-channel-hand-to-hand">Unbuffered Channel (Hand-to-Hand)</h3>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#bf616a;">ch </span><span>:= </span><span style="color:#96b5b4;">make</span><span>(</span><span style="color:#b48ead;">chan int</span><span>) </span><span style="color:#65737e;">// capacity = 0
</span></code></pre>
<p><strong>Rule:</strong> Send and receive must meet simultaneously.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Worker:  &quot;I have a result!&quot; → [BLOCKS until main is ready]
</span><span>Main:    &quot;I&#39;m ready!&quot;        → [Both unblock together]
</span></code></pre>
<p><strong>Consequence:</strong></p>
<ul>
<li>Tight coupling.</li>
<li>Worker must wait for main.</li>
<li>Slower in practice.</li>
</ul>
<h3 id="buffered-channel-drop-box">Buffered Channel (Drop Box)</h3>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#bf616a;">results </span><span>:= </span><span style="color:#96b5b4;">make</span><span>(</span><span style="color:#b48ead;">chan int</span><span>, </span><span style="color:#d08770;">5</span><span>) </span><span style="color:#65737e;">// capacity = 5
</span></code></pre>
<p><strong>Rule:</strong> Send succeeds if there's free space.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Worker:  &quot;I have a result!&quot; → [Drop in box] → [Continue immediately]
</span><span>Main (later): &quot;Give me results&quot; → [Take from box]
</span></code></pre>
<p><strong>Consequence:</strong></p>
<ul>
<li>Decoupled.</li>
<li>Workers don't wait.</li>
<li>Higher throughput.</li>
</ul>
<h2 id="why-buffered-is-faster">Why Buffered Is Faster</h2>
<h3 id="unbuffered-timeline">Unbuffered Timeline</h3>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Worker finishes → waits for main
</span><span>Main receives   → wakes worker
</span><span>(repeated handshake for each result)
</span></code></pre>
<p>Like calling someone for every single delivery.</p>
<h3 id="buffered-timeline">Buffered Timeline</h3>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Worker finishes → drops package → leaves
</span><span>Main picks up packages later
</span></code></pre>
<p>Like using a mailbox.</p>
<h2 id="common-mistakes">Common Mistakes</h2>
<h3 id="x-forgetting-to-receive-all-results">❌ Forgetting to receive all results</h3>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#b48ead;">for </span><span style="color:#bf616a;">a </span><span>:= </span><span style="color:#d08770;">1</span><span>; </span><span style="color:#bf616a;">a </span><span>&lt;= </span><span style="color:#bf616a;">numJobs</span><span>-</span><span style="color:#d08770;">1</span><span>; </span><span style="color:#bf616a;">a</span><span>++ { </span><span style="color:#65737e;">// Off by one!
</span><span>	&lt;-</span><span style="color:#bf616a;">results
</span><span>}
</span></code></pre>
<p><strong>Result:</strong> One worker blocks forever. Goroutine leak.</p>
<h3 id="x-forgetting-to-close-the-jobs-channel">❌ Forgetting to close the jobs channel</h3>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span style="color:#65737e;">// close(jobs) ← MISSING
</span></code></pre>
<p><strong>Result:</strong> Workers block forever in <code>range jobs</code>. Leak.</p>
<h2 id="when-to-use-channels-vs-waitgroup">When to Use Channels vs. WaitGroup</h2>
<table><thead><tr><th>Use Case</th><th>Tool</th></tr></thead><tbody>
<tr><td>Only waiting</td><td><code>WaitGroup</code></td></tr>
<tr><td>Data + waiting</td><td>Channels</td></tr>
<tr><td>Pipelines</td><td>Channels</td></tr>
<tr><td>Fan-out/fan-in</td><td>Channels</td></tr>
<tr><td>Phases</td><td><code>WaitGroup</code></td></tr>
<tr><td>Cancellation</td><td><code>context</code></td></tr>
</tbody></table>
<h2 id="summary">Summary</h2>
<ol>
<li><strong>Channels synchronize implicitly</strong> via blocking semantics.</li>
<li><strong>Buffered channels decouple</strong> senders and receivers, improving throughput.</li>
<li><strong>Worker pools leverage channels</strong> for both data flow and lifecycle management.</li>
<li><strong>The number of results received</strong> is the completion signal—no <code>WaitGroup</code> needed.</li>
</ol>

        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read more posts?</span>
                    <hr />
                </div>
                <div class="pagination__buttons">
                        <span class="button previous">
                            <a href="https://pallabcodes.github.io/go-signals/">
                                <span class="button__icon">←</span>&nbsp;
                                <span class="button__text">Handling OS Signals in Go</span>
                            </a>
                        </span>
                    
                    
                        <span class="button next">
                            <a href="https://pallabcodes.github.io/share-memory-communicating-part-4/">
                                <span class="button__text">Share Memory by Communicating Part 4: Scaling &amp; Production Patterns</span>&nbsp;
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    </div>
            </div>
        
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2025
 Pallab</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
